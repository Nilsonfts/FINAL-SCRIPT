/**
 * –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–û–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò
 * –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ä–∞–±–æ—Ç—É –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
 */

/**
 * –î–µ–º–æ: —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
 */
function demoCreateFullStructure() {
  try {
    console.log('üöÄ –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –°–û–ó–î–ê–ù–ò–Ø –ü–û–õ–ù–û–ô –°–¢–†–£–ö–¢–£–†–´ –†–ê–ë–û–ß–ò–ô –ê–ú–û');
    
    // 1. –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å–≤–æ–¥–Ω–æ–≥–æ –ª–∏—Å—Ç–∞
    console.log('\n1Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–≤–æ–¥–Ω–æ–≥–æ –ª–∏—Å—Ç–∞...');
    const workingSheet = createWorkingAmoStructure();
    console.log('‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
    
    // 2. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É
    console.log('\n2Ô∏è‚É£ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞ —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏:');
    const headers = getUnifiedHeaders_();
    headers.forEach((header, index) => {
      const columnLetter = String.fromCharCode(65 + index);
      console.log(`${columnLetter}. ${header}`);
    });
    
    console.log(`\nüìä –ò—Ç–æ–≥–æ —Å–æ–∑–¥–∞–Ω–æ ${headers.length} –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö`);
    
    // 3. –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    console.log('\n3Ô∏è‚É£ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö...');
    createDemoData_(workingSheet, headers);
    console.log('‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã');
    
    // 4. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
    console.log('\n4Ô∏è‚É£ –ó–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏...');
    diagnoseWorkingAmoStructure();
    
    console.log('\nüéâ –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê!');
    console.log('\nüìã –ß–¢–û –°–û–ó–î–ê–ù–û:');
    console.log('‚Ä¢ –õ–∏—Å—Ç "–†–ê–ë–û–ß–ò–ô –ê–ú–û" —Å –ø–æ–ª–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π');
    console.log('‚Ä¢ 48 –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö');
    console.log('‚Ä¢ –ö—Ä–∞—Å–∏–≤–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å —Ü–≤–µ—Ç–Ω—ã–º–∏ –±–ª–æ–∫–∞–º–∏');
    console.log('‚Ä¢ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏');
    console.log('‚Ä¢ –ê–≤—Ç–æ—Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è —É–¥–æ–±–Ω–æ–π —Ä–∞–±–æ—Ç—ã');
    
    console.log('\nüîß –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:');
    console.log('1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ updateWorkingAmoFromAllSources() –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö');
    console.log('2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ diagnoseRefusalData() –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–∫–∞–∑–æ–≤');
    console.log('3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ analyzeRefusalReasons() –¥–ª—è GPT-–∞–Ω–∞–ª–∏–∑–∞');
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏:', error);
  }
}

/**
 * –°–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
 * @param {Sheet} sheet - –†–∞–±–æ—á–∏–π –ª–∏—Å—Ç
 * @param {Array} headers - –ó–∞–≥–æ–ª–æ–≤–∫–∏
 * @private
 */
function createDemoData_(sheet, headers) {
  const demoData = [
    // –°—Ç—Ä–æ–∫–∞ 1: –£—Å–ø–µ—à–Ω–∞—è —Å–¥–µ–ª–∫–∞ –∏–∑ AmoCRM
    [
      '12345',                           // ID
      '–ó–∞—è–≤–∫–∞ –Ω–∞ –±–∞–Ω–∫–µ—Ç - –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤',  // –ù–∞–∑–≤–∞–Ω–∏–µ
      '–ú–µ–Ω–µ–¥–∂–µ—Ä –°–∏–¥–æ—Ä–æ–≤–∞ –ê.–í.',          // –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π
      '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤',                     // –ö–æ–Ω—Ç–∞–∫—Ç.–§–ò–û
      '–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ',             // –°—Ç–∞—Ç—É—Å
      '150000',                          // –ë—é–¥–∂–µ—Ç
      '2025-01-10',                      // –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
      '+7 (999) 123-45-67',              // –ö–æ–Ω—Ç–∞–∫—Ç.–¢–µ–ª–µ—Ñ–æ–Ω
      'ivan.petrov@example.com',         // Email
      '8 (800) 555-01-01',               // –ù–æ–º–µ—Ä –ª–∏–Ω–∏–∏ MANGO OFFICE
      'VIP, –ë–∞–Ω–∫–µ—Ç',                     // –¢–µ–≥–∏
      '2025-01-15',                      // –î–∞—Ç–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
      '',                                // –ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–∞–∑–∞ (–ø—É—Å—Ç–æ - —É—Å–ø–µ—à–Ω–∞—è —Å–¥–µ–ª–∫–∞)
      '–¶–µ–ª–µ–≤–æ–π',                         // –¢–∏–ø –ª–∏–¥–∞
      '2025-01-20',                      // –î–∞—Ç–∞ –±—Ä–æ–Ω–∏
      '19:00',                           // –í—Ä–µ–º—è –ø—Ä–∏—Ö–æ–¥–∞
      '25',                              // –ö–æ–ª-–≤–æ –≥–æ—Å—Ç–µ–π
      '–§–∏–ª–∏–∞–ª –¶–µ–Ω—Ç—Ä',                    // –ë–∞—Ä
      '–Ø–Ω–¥–µ–∫—Å.–î–∏—Ä–µ–∫—Ç',                   // –ò—Å—Ç–æ—á–Ω–∏–∫
      '–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞',             // R.–ò—Å—Ç–æ—á–Ω–∏–∫ —Å–¥–µ–ª–∫–∏
      '–í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫',                 // R.–ò—Å—Ç–æ—á–Ω–∏–∫ –¢–ï–õ —Å–¥–µ–ª–∫–∏
      'CRM System',                      // –ü–û
      'yandex',                          // UTM_SOURCE
      'cpc',                             // UTM_MEDIUM
      'banket_campaign',                 // UTM_CAMPAIGN
      '–±–∞–Ω–∫–µ—Ç –º–æ—Å–∫–≤–∞',                   // UTM_TERM
      'ad_group_1',                      // UTM_CONTENT
      'yandex.ru',                       // utm_referrer
      '1234567890123456789',             // YM_CLIENT_ID
      '9876543210987654321',             // GA_CLIENT_ID
      '1641234567890123456'              // _ym_uid
    ],
    
    // –°—Ç—Ä–æ–∫–∞ 2: –û—Ç–∫–∞–∑–∞–Ω–Ω–∞—è —Å–¥–µ–ª–∫–∞ —Å –ø—Ä–∏—á–∏–Ω–æ–π
    [
      '12346',                           // ID
      '–ó–∞–∫–∞–∑ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–∞ - –û–û–û –†–æ–º–∞—à–∫–∞', // –ù–∞–∑–≤–∞–Ω–∏–µ
      '–ú–µ–Ω–µ–¥–∂–µ—Ä –ò–≤–∞–Ω–æ–≤ –ü.–°.',            // –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π
      '–ê–Ω–Ω–∞ –°–∏–¥–æ—Ä–æ–≤–∞',                   // –ö–æ–Ω—Ç–∞–∫—Ç.–§–ò–û
      '–ó–∞–∫—Ä—ã—Ç–æ –∏ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ',        // –°—Ç–∞—Ç—É—Å ‚≠ê –û–¢–ö–ê–ó
      '200000',                          // –ë—é–¥–∂–µ—Ç
      '2025-01-08',                      // –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
      '+7 (999) 987-65-43',              // –ö–æ–Ω—Ç–∞–∫—Ç.–¢–µ–ª–µ—Ñ–æ–Ω
      'anna.sidorova@romashka.ru',       // Email
      '8 (800) 555-01-02',               // –ù–æ–º–µ—Ä –ª–∏–Ω–∏–∏ MANGO OFFICE
      '–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤',                      // –¢–µ–≥–∏
      '2025-01-12',                      // –î–∞—Ç–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
      '–°–ª–∏—à–∫–æ–º –¥–æ—Ä–æ–≥–æ, –Ω–∞—à–ª–∏ –¥–µ—à–µ–≤–ª–µ —É –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –Ω–∞ 30%', // –ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–∞–∑–∞ ‚≠ê
      '–¶–µ–ª–µ–≤–æ–π',                         // –¢–∏–ø –ª–∏–¥–∞
      '2025-02-14',                      // –î–∞—Ç–∞ –±—Ä–æ–Ω–∏
      '18:30',                           // –í—Ä–µ–º—è –ø—Ä–∏—Ö–æ–¥–∞
      '50',                              // –ö–æ–ª-–≤–æ –≥–æ—Å—Ç–µ–π
      '–§–∏–ª–∏–∞–ª –°–µ–≤–µ—Ä',                    // –ë–∞—Ä
      'Google Ads',                      // –ò—Å—Ç–æ—á–Ω–∏–∫
      '–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞',             // R.–ò—Å—Ç–æ—á–Ω–∏–∫ —Å–¥–µ–ª–∫–∏
      '–§–æ—Ä–º–∞ –Ω–∞ —Å–∞–π—Ç–µ',                  // R.–ò—Å—Ç–æ—á–Ω–∏–∫ –¢–ï–õ —Å–¥–µ–ª–∫–∏
      'Google Ads',                      // –ü–û
      'google',                          // UTM_SOURCE
      'cpc',                             // UTM_MEDIUM
      'corporate_events',                // UTM_CAMPAIGN
      '–∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω',             // UTM_TERM
      'ad_text_2',                       // UTM_CONTENT
      'google.com'                       // utm_referrer
    ],
    
    // –°—Ç—Ä–æ–∫–∞ 3: –ï—â–µ –æ–¥–∏–Ω –æ—Ç–∫–∞–∑ —Å –¥—Ä—É–≥–æ–π –ø—Ä–∏—á–∏–Ω–æ–π
    [
      '12347',                           // ID
      '–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è - –ú–∏—Ö–∞–∏–ª –ö.',       // –ù–∞–∑–≤–∞–Ω–∏–µ
      '–ú–µ–Ω–µ–¥–∂–µ—Ä –ü–µ—Ç—Ä–æ–≤–∞ –ï.–ê.',           // –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π
      '–ú–∏—Ö–∞–∏–ª –ö–æ–∑–ª–æ–≤',                   // –ö–æ–Ω—Ç–∞–∫—Ç.–§–ò–û
      '–ó–∞–∫—Ä—ã—Ç–æ –∏ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ',        // –°—Ç–∞—Ç—É—Å ‚≠ê –û–¢–ö–ê–ó
      '80000',                           // –ë—é–¥–∂–µ—Ç
      '2025-01-09',                      // –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
      '+7 (999) 555-77-88',              // –ö–æ–Ω—Ç–∞–∫—Ç.–¢–µ–ª–µ—Ñ–æ–Ω
      'mikhail.kozlov@gmail.com',        // Email
      '8 (800) 555-01-03',               // –ù–æ–º–µ—Ä –ª–∏–Ω–∏–∏ MANGO OFFICE
      '–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è',                   // –¢–µ–≥–∏
      '2025-01-11',                      // –î–∞—Ç–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
      '–ù–µ —É—Å—Ç—Ä–æ–∏–ª–æ –∫–∞—á–µ—Å—Ç–≤–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –ø—Ä–∏ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –ø–æ—Å–µ—â–µ–Ω–∏–∏', // –ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–∞–∑–∞ ‚≠ê
      '–ü–æ–≤—Ç–æ—Ä–Ω—ã–π',                       // –¢–∏–ø –ª–∏–¥–∞
      '2025-01-25',                      // –î–∞—Ç–∞ –±—Ä–æ–Ω–∏
      '20:00',                           // –í—Ä–µ–º—è –ø—Ä–∏—Ö–æ–¥–∞
      '15',                              // –ö–æ–ª-–≤–æ –≥–æ—Å—Ç–µ–π
      '–§–∏–ª–∏–∞–ª –Æ–≥',                       // –ë–∞—Ä
      '–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏',                 // –ò—Å—Ç–æ—á–Ω–∏–∫
      'Instagram',                       // R.–ò—Å—Ç–æ—á–Ω–∏–∫ —Å–¥–µ–ª–∫–∏
      '–°–æ–æ–±—â–µ–Ω–∏–µ –≤ Direct',              // R.–ò—Å—Ç–æ—á–Ω–∏–∫ –¢–ï–õ —Å–¥–µ–ª–∫–∏
      'Instagram',                       // –ü–û
      'instagram',                       // UTM_SOURCE
      'social',                          // UTM_MEDIUM
      'birthday_promo',                  // UTM_CAMPAIGN
      '',                                // UTM_TERM
      'stories_ad'                       // UTM_CONTENT
    ]
  ];
  
  // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –ª–∏—Å—Ç
  if (demoData.length > 0) {
    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –∏–º–µ—é—â–∏–µ—Å—è –∫–æ–ª–æ–Ω–∫–∏, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ—Å—Ç–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–º–∏
    const fullRows = demoData.map(row => {
      const fullRow = new Array(headers.length).fill('');
      row.forEach((value, index) => {
        if (index < fullRow.length) {
          fullRow[index] = value;
        }
      });
      return fullRow;
    });
    
    sheet.getRange(4, 1, fullRows.length, headers.length).setValues(fullRows);
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫ —Å—Ç—Ä–æ–∫–∞–º —Å –¥–∞–Ω–Ω—ã–º–∏
    const dataRange = sheet.getRange(4, 1, fullRows.length, headers.length);
    
    // –ß–µ—Ä–µ–¥—É–µ–º —Ü–≤–µ—Ç–∞ —Å—Ç—Ä–æ–∫
    for (let i = 0; i < fullRows.length; i++) {
      const rowRange = sheet.getRange(4 + i, 1, 1, headers.length);
      const bgColor = i % 2 === 0 ? '#f8f9fa' : '#ffffff';
      
      // –í—ã–¥–µ–ª—è–µ–º –æ—Ç–∫–∞–∑–∞–Ω–Ω—ã–µ —Å–¥–µ–ª–∫–∏
      const statusIndex = headers.indexOf('–°—Ç–∞—Ç—É—Å');
      if (statusIndex >= 0 && fullRows[i][statusIndex] === '–ó–∞–∫—Ä—ã—Ç–æ –∏ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ') {
        rowRange.setBackground('#fff3e0'); // –û—Ä–∞–Ω–∂–µ–≤—ã–π —Ñ–æ–Ω –¥–ª—è –æ—Ç–∫–∞–∑–æ–≤
      } else {
        rowRange.setBackground(bgColor);
      }
    }
    
    console.log(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ ${fullRows.length} —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π`);
    console.log('üìä –í–∫–ª—é—á–∞–µ—Ç: 1 —É—Å–ø–µ—à–Ω—É—é —Å–¥–µ–ª–∫—É –∏ 2 –æ—Ç–∫–∞–∑–∞ —Å –ø—Ä–∏—á–∏–Ω–∞–º–∏');
  }
}

/**
 * –î–µ–º–æ: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
 */
function demoMergeFromSources() {
  try {
    console.log('üîÑ –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –û–ë–™–ï–î–ò–ù–ï–ù–ò–Ø –î–ê–ù–ù–´–• –ò–ó –ò–°–¢–û–ß–ù–ò–ö–û–í');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ª–∏—Å—Ç—ã-–∏—Å—Ç–æ—á–Ω–∏–∫–∏
    const spreadsheet = SpreadsheetApp.getActiveSpreadsheet();
    const allSheets = spreadsheet.getSheets().map(sheet => sheet.getName());
    
    console.log('\nüìã –î–û–°–¢–£–ü–ù–´–ï –õ–ò–°–¢–´:');
    allSheets.forEach(sheetName => {
      console.log(`‚Ä¢ ${sheetName}`);
    });
    
    // –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è
    const dataSources = [
      { sheetName: '–ê–º–æ –í—ã–≥—Ä—É–∑–∫–∞', type: 'AMO_EXPORT' },
      { sheetName: '–í—ã–≥—Ä—É–∑–∫–∞ –ê–º–æ –ü–æ–ª–Ω–∞—è', type: 'AMO_FULL_EXPORT' },
      { sheetName: 'Reserves RP', type: 'RESERVES_RP' },
      { sheetName: 'Guests RP', type: 'GUESTS_RP' },
      { sheetName: '–ó–∞—è–≤–∫–∏ —Å –°–∞–π—Ç–∞', type: 'WEBSITE_FORMS' },
      { sheetName: '–ö–æ–ª–ª–¢—Ä–µ–∫–∏–Ω–≥', type: 'CALL_TRACKING' }
    ];
    
    console.log('\nüéØ –ü–û–ò–°–ö –ò–°–¢–û–ß–ù–ò–ö–û–í –î–ê–ù–ù–´–•:');
    let foundSources = 0;
    
    dataSources.forEach(source => {
      if (allSheets.includes(source.sheetName)) {
        console.log(`‚úÖ –ù–∞–π–¥–µ–Ω: ${source.sheetName} (—Ç–∏–ø: ${source.type})`);
        foundSources++;
      } else {
        console.log(`‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω: ${source.sheetName}`);
      }
    });
    
    if (foundSources === 0) {
      console.log('\n‚ö†Ô∏è –ù–ï –ù–ê–ô–î–ï–ù–û –ò–°–¢–û–ß–ù–ò–ö–û–í –î–ê–ù–ù–´–•');
      console.log('üìù –î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:');
      console.log('1. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ AmoCRM –≤ –ª–∏—Å—Ç—ã "–ê–º–æ –í—ã–≥—Ä—É–∑–∫–∞"/"–í—ã–≥—Ä—É–∑–∫–∞ –ê–º–æ –ü–æ–ª–Ω–∞—è"');
      console.log('2. –î–æ–±–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ RestoPlatform –≤ –ª–∏—Å—Ç—ã "Reserves RP"/"Guests RP"');
      console.log('3. –ó–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞—è–≤–∫–∏ —Å —Å–∞–π—Ç–∞ –≤ –ª–∏—Å—Ç "–ó–∞—è–≤–∫–∏ —Å –°–∞–π—Ç–∞"');
      console.log('4. –ü–æ–¥–∫–ª—é—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–æ–ª–ª—Ç—Ä–µ–∫–∏–Ω–≥–∞ –≤ –ª–∏—Å—Ç "–ö–æ–ª–ª–¢—Ä–µ–∫–∏–Ω–≥"');
      
      console.log('\nüîß –°–æ–∑–¥–∞–µ–º –¥–µ–º–æ-—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...');
      demoCreateFullStructure();
      
    } else {
      console.log(`\nüöÄ –ù–∞–π–¥–µ–Ω–æ ${foundSources} –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤, –Ω–∞—á–∏–Ω–∞–µ–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ...`);
      const totalMerged = updateWorkingAmoFromAllSources();
      
      console.log(`\n‚úÖ –û–ë–™–ï–î–ò–ù–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û!`);
      console.log(`üìä –í—Å–µ–≥–æ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: ${totalMerged}`);
      
      // –ó–∞–ø—É—Å–∫–∞–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
      console.log('\nüîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –û–ë–™–ï–î–ò–ù–ï–ù–ù–´–• –î–ê–ù–ù–´–•:');
      diagnoseWorkingAmoStructure();
    }
    
    console.log('\nüéØ –ì–û–¢–û–í–û –ö –ê–ù–ê–õ–ò–ó–£ –û–¢–ö–ê–ó–û–í!');
    console.log('–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: diagnoseRefusalData() ‚Üí analyzeRefusalReasons()');
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è:', error);
  }
}

/**
 * –î–µ–º–æ: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∞–Ω–∞–ª–∏–∑–∞ –æ—Ç–∫–∞–∑–æ–≤ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
 */
function demoRefusalAnalysisFullCycle() {
  try {
    console.log('üî¨ –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –ü–û–õ–ù–û–ì–û –¶–ò–ö–õ–ê –ê–ù–ê–õ–ò–ó–ê –û–¢–ö–ê–ó–û–í');
    
    // 1. –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É (–µ—Å–ª–∏ –Ω–µ—Ç)
    console.log('\n1Ô∏è‚É£ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö...');
    const spreadsheet = SpreadsheetApp.getActiveSpreadsheet();
    let workingSheet = spreadsheet.getSheetByName('–†–ê–ë–û–ß–ò–ô –ê–ú–û');
    
    if (!workingSheet || workingSheet.getLastRow() < 4) {
      console.log('üìù –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É...');
      demoCreateFullStructure();
    } else {
      console.log('‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞–π–¥–µ–Ω–∞');
    }
    
    // 2. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    console.log('\n2Ô∏è‚É£ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –æ—Ç–∫–∞–∑–æ–≤...');
    diagnoseRefusalData();
    
    // 3. –ó–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞ –æ—Ç–∫–∞–∑–æ–≤
    console.log('\n3Ô∏è‚É£ –ó–∞–ø—É—Å–∫ GPT-–∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–∏—á–∏–Ω –æ—Ç–∫–∞–∑–æ–≤...');
    try {
      analyzeRefusalReasons();
      console.log('‚úÖ GPT-–∞–Ω–∞–ª–∏–∑ –æ—Ç–∫–∞–∑–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ');
      
      // 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
      console.log('\n4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞...');
      const refusalSheet = spreadsheet.getSheetByName('–ê–Ω–∞–ª–∏–∑ –æ—Ç–∫–∞–∑–æ–≤');
      if (refusalSheet) {
        const lastRow = refusalSheet.getLastRow();
        console.log(`‚úÖ –û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω, —Å–æ–¥–µ—Ä–∂–∏—Ç ${lastRow} —Å—Ç—Ä–æ–∫`);
        console.log('üìä –û—Ç—á–µ—Ç –≤–∫–ª—é—á–∞–µ—Ç: –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏—á–∏–Ω, –∏–Ω—Å–∞–π—Ç—ã, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, –¥–∏–∞–≥—Ä–∞–º–º—ã');
      } else {
        console.log('‚ùå –û—Ç—á–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
      }
      
    } catch (analysisError) {
      console.log('‚ö†Ô∏è –û—à–∏–±–∫–∞ GPT-–∞–Ω–∞–ª–∏–∑–∞ (–≤–æ–∑–º–æ–∂–Ω–æ, –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω API –∫–ª—é—á)');
      console.log('üìù –†–µ–∑—É–ª—å—Ç–∞—Ç: –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ª–æ–∫–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤');
    }
    
    console.log('\nüéâ –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –ü–û–õ–ù–û–ì–û –¶–ò–ö–õ–ê –ó–ê–í–ï–†–®–ï–ù–ê!');
    
    console.log('\nüìã –ß–¢–û –ë–´–õ–û –ü–†–û–î–ï–ú–û–ù–°–¢–†–ò–†–û–í–ê–ù–û:');
    console.log('‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –†–ê–ë–û–ß–ò–ô –ê–ú–û');
    console.log('‚úÖ –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –∏–∑ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö');
    console.log('‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –æ—Ç–∫–∞–∑–æ–≤');
    console.log('‚úÖ GPT-–∞–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω –æ—Ç–∫–∞–∑–æ–≤ —Å –∫—Ä–∞—Å–∏–≤—ã–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º');
    console.log('‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤ —Å –¥–∏–∞–≥—Ä–∞–º–º–∞–º–∏');
    
    console.log('\nüí° –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –ù–û–í–û–ô –°–ò–°–¢–ï–ú–´:');
    console.log('üéØ –ï–¥–∏–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö');
    console.log('üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π');
    console.log('üìä –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –≤—Å–µ–º –∫–∞–Ω–∞–ª–∞–º');
    console.log('ü§ñ GPT-–∞–Ω–∞–ª–∏–∑ —Å —É–º–Ω—ã–º rate limiting');
    console.log('üé® –ö—Ä–∞—Å–∏–≤—ã–µ –æ—Ç—á–µ—Ç—ã –∫–∞–∫ –≤ —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏—è—Ö');
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞:', error);
  }
}
