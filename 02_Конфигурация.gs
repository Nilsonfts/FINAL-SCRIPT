/**
 * üìä –¶–ï–ù–¢–†–ê–õ–¨–ù–´–ô –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–û–ù–ù–´–ô –§–ê–ô–õ
 * –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
 * –í–µ—Ä—Å–∏—è: 2.0
 */

const CONFIG = {
  // ===== –û–ë–©–ò–ï –ù–ê–°–¢–†–û–ô–ö–ò =====
  API_KEY: PropertiesService.getScriptProperties().getProperty('OPENAI_API_KEY'),
  TIMEZONE: 'Europe/Moscow',
  FONT: 'PT Sans',
  
  // ===== –û–¢–õ–ê–î–ö–ê –ò –õ–û–ì–ò–†–û–í–ê–ù–ò–ï =====
  DEBUG: {
    enabled: true,
    verbose: false
  },
  
  // ===== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ò–ú–ï–ù–ê –õ–ò–°–¢–û–í =====
  SHEETS: {
    // –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    AMO_EXPORT: '–ê–º–æ –í—ã–≥—Ä—É–∑–∫–∞',
    AMO_FULL: '–í—ã–≥—Ä—É–∑–∫–∞ –ê–º–æ –ü–æ–ª–Ω–∞—è',
    WEB_FORMS: '–ó–∞—è–≤–∫–∏ —Å –°–∞–π—Ç–∞',
    RESERVES: 'Reserves RP',
    GUESTS: 'Guests RP',
    CALLTRACKING: '–ö–æ–ª–ª–¢—Ä–µ–∫–∏–Ω–≥',
    
    // –†–∞–±–æ—á–∏–µ –ª–∏—Å—Ç—ã
    WORKING_AMO: '–†–ê–ë–û–ß–ò–ô –ê–ú–û',
    
    // –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –ª–∏—Å—Ç—ã
    AMOCRM_SUMMARY: 'AmoCRM: –°–≤–æ–¥–∫–∞',
    REFUSAL_ANALYSIS: '–ê–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω –æ—Ç–∫–∞–∑–æ–≤',
    CHANNEL_ANALYSIS: '–ê–Ω–∞–ª–∏–∑ –∫–∞–Ω–∞–ª–æ–≤',
    LEADS_ANALYSIS: '–õ–∏–¥—ã –ø–æ –∫–∞–Ω–∞–ª–∞–º', 
    UTM_ANALYSIS: 'UTM –∞–Ω–∞–ª–∏—Ç–∏–∫–∞',
    FIRST_TOUCH: '–ü–µ—Ä–≤—ã–µ –∫–∞—Å–∞–Ω–∏—è',
    DAILY_STATISTICS: '–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
    MONTHLY_COMPARISON: '–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Å—è—Ü–µ–≤',
    MANAGER_PERFORMANCE: '–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤',
    
    // –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–∏—Å—Ç—ã
    MAIN_DASHBOARD: '–ì–ª–∞–≤–Ω–∞—è',
    ADVANCED_ANALYTICS: '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –ê–Ω–∞–ª–∏—Ç–∏–∫–∞',
    SYSTEM_LOGS: '–°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏',
    
    // –ü–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö
    NEW_ONLY: '–ù–û–í–´–ï',
    PROBLEMS: '–ü–†–û–ë–õ–ï–ú–ù–´–ï',
    DIAGNOSTICS: '_DIAG'
  },
  
  // ===== –°–¢–†–£–ö–¢–£–†–ê –ö–û–õ–û–ù–û–ö "–†–ê–ë–û–ß–ò–ô –ê–ú–û" =====
  WORKING_AMO_COLUMNS: {
    // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–¥–µ–ª–∫–µ (A-K)
    ID: 'A',                          // –°–¥–µ–ª–∫–∞.ID
    NAME: 'B',                        // –°–¥–µ–ª–∫–∞.–ù–∞–∑–≤–∞–Ω–∏–µ  
    STATUS: 'C',                      // –°–¥–µ–ª–∫–∞.–°—Ç–∞—Ç—É—Å
    REFUSAL_REASON: 'D',              // –°–¥–µ–ª–∫–∞.–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–∞–∑–∞
    LEAD_TYPE: 'E',                   // –°–¥–µ–ª–∫–∞.–¢–∏–ø –ª–∏–¥–∞
    GUEST_STATUS: 'F',                // –°–¥–µ–ª–∫–∞.R.–°—Ç–∞—Ç—É—Å—ã –≥–æ—Å—Ç–µ–π
    RESPONSIBLE: 'G',                 // –°–¥–µ–ª–∫–∞.–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π
    TAGS: 'H',                        // –°–¥–µ–ª–∫–∞.–¢–µ–≥–∏
    BUDGET: 'I',                      // –°–¥–µ–ª–∫–∞.–ë—é–¥–∂–µ—Ç
    CREATED_AT: 'J',                  // –°–¥–µ–ª–∫–∞.–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
    CLOSED_AT: 'K',                   // –°–¥–µ–ª–∫–∞.–î–∞—Ç–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
    
    // –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ —Å—á–µ—Ç–∞ (L-P)
    MANGO_LINE2: 'L',                 // –ö–æ–Ω—Ç–∞–∫—Ç.–ù–æ–º–µ—Ä –ª–∏–Ω–∏–∏ MANGO OFFICE
    MANGO_LINE1: 'M',                 // –°–¥–µ–ª–∫–∞.–ù–æ–º–µ—Ä –ª–∏–Ω–∏–∏ MANGO OFFICE  
    CONTACT_NAME: 'N',                // –ö–æ–Ω—Ç–∞–∫—Ç.–§–ò–û
    PHONE: 'O',                       // –ö–æ–Ω—Ç–∞–∫—Ç.–¢–µ–ª–µ—Ñ–æ–Ω
    BILL_FACT: 'P',                   // –°—á–µ—Ç —Ñ–∞–∫—Ç (–ù–û–í–ê–Ø –ö–û–õ–û–ù–ö–ê)
    
    // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ UTM (Q-AO)
    DATE: 'Q',                        // –°–¥–µ–ª–∫–∞.DATE
    TIME: 'R',                        // –°–¥–µ–ª–∫–∞.TIME
    CITY_TAG: 'S',                    // –°–¥–µ–ª–∫–∞.R.–¢–µ–≥ –≥–æ—Ä–æ–¥–∞
    BOOKING_DATE: 'T',                // –°–¥–µ–ª–∫–∞.–î–∞—Ç–∞ –±—Ä–æ–Ω–∏
    SOFTWARE: 'U',                    // –°–¥–µ–ª–∫–∞.–ü–û
    REFERRAL_TYPE: 'V',               // –°–¥–µ–ª–∫–∞.–°–∞—Ä–∞—Ñ–∞–Ω –≥–æ—Å—Ç–∏
    BAR_NAME: 'W',                    // –°–¥–µ–ª–∫–∞.–ë–∞—Ä (deal)
    DEAL_SOURCE: 'X',                 // –°–¥–µ–ª–∫–∞.R.–ò—Å—Ç–æ—á–Ω–∏–∫ —Å–¥–µ–ª–∫–∏
    BUTTON_TEXT: 'Y',                 // –°–¥–µ–ª–∫–∞.BUTTON_TEXT
    YM_CLIENT_ID: 'Z',                // –°–¥–µ–ª–∫–∞.YM_CLIENT_ID
    GA_CLIENT_ID: 'AA',               // –°–¥–µ–ª–∫–∞.GA_CLIENT_ID
    UTM_SOURCE: 'AB',                 // –°–¥–µ–ª–∫–∞.UTM_SOURCE
    UTM_MEDIUM: 'AC',                 // –°–¥–µ–ª–∫–∞.UTM_MEDIUM
    UTM_CAMPAIGN: 'AD',               // –°–¥–µ–ª–∫–∞.UTM_CAMPAIGN
    UTM_CONTENT: 'AE',                // –°–¥–µ–ª–∫–∞.UTM_CONTENT
    UTM_TERM: 'AF',                   // –°–¥–µ–ª–∫–∞.UTM_TERM
    REFERER: 'AG',                    // –°–¥–µ–ª–∫–∞.REFERER
    FORMID: 'AH',                     // –°–¥–µ–ª–∫–∞.FORMID
    FORMNAME: 'AI',                   // –°–¥–µ–ª–∫–∞.FORMNAME
    YM_UID: 'AJ',                     // –°–¥–µ–ª–∫–∞._ym_uid
    NOTES: 'AK',                      // –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
    DAYS_TO_BOOKING: 'AL',            // –î–Ω–∏ –¥–æ –±—Ä–æ–Ω–∏
    CHANNEL_GROUP: 'AM',              // –ì—Ä—É–ø–ø–∞ –∫–∞–Ω–∞–ª–æ–≤
    SUCCESS_FLAG: 'AN',               // –§–ª–∞–≥ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏
    MONTH_YEAR: 'AO'                  // –ú–µ—Å—è—Ü-–ì–æ–¥
  },
  
  // ===== –û–°–ù–û–í–ù–û–ô –°–ö–†–ò–ü–¢ –°–ë–û–†–ê –î–ê–ù–ù–´–• =====
  mainScript: {
    SHEETS: {
      NEW: '–ê–º–æ –í—ã–≥—Ä—É–∑–∫–∞',
      FULL: '–í—ã–≥—Ä—É–∑–∫–∞ –ê–º–æ –ü–æ–ª–Ω–∞—è', 
      SITE: '–ó–∞—è–≤–∫–∏ —Å –°–∞–π—Ç–∞',
      RES: 'Reserves RP',
      GUE: 'Guests RP',
      CALL: '–ö–æ–ª–ª–¢—Ä–µ–∫–∏–Ω–≥',
      OUT: '–†–ê–ë–û–ß–ò–ô –ê–ú–û',
      DIAG: '_DIAG',
      NEW_ONLY: '–ù–û–í–´–ï',
      PROBLEM: '–ü–†–û–ë–õ–ï–ú–ù–´–ï',
      LOG: 'LOG'
    },
    KEY: '–°–¥–µ–ª–∫–∞.ID',
    CLOSED_RE: /(–∑–∞–∫—Ä—ã|—É—Å–ø–µ—à|–Ω–µ—É—Å–ø–µ—à|–æ–ø–ª–∞—á)/i,
    PHONE_SPLIT_RE: /[;,]/,
    COLORS: { NEW:'#ccffcc', URGENT:'#ffe599', OVERDUE:'#f4cccc', LONG:'#fff2cc' },
    PRESERVE_STYLES: true,
    
    // –ú–∞–ø–ø–∏–Ω–≥ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
    MAP: {
      '–°–¥–µ–ª–∫–∞.ID': ['ID','id','–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä','–ù–æ–º–µ—Ä'],
      '–°–¥–µ–ª–∫–∞.–ù–∞–∑–≤–∞–Ω–∏–µ': ['–ù–∞–∑–≤–∞–Ω–∏–µ','Name','–ù–∞–∑–≤–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏'],
      '–°–¥–µ–ª–∫–∞.–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è': ['–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è','Created','DATE'],
      '–°–¥–µ–ª–∫–∞.–°—Ç–∞—Ç—É—Å': ['–°—Ç–∞—Ç—É—Å','Status','–≠—Ç–∞–ø —Å–¥–µ–ª–∫–∏'],
      '–°–¥–µ–ª–∫–∞.–ë—é–¥–∂–µ—Ç': ['–ë—é–¥–∂–µ—Ç','Budget','–°—É–º–º–∞'],
      '–°–¥–µ–ª–∫–∞.–î–∞—Ç–∞ –∑–∞–∫—Ä—ã—Ç–∏—è': ['–î–∞—Ç–∞ –∑–∞–∫—Ä—ã—Ç–∏—è'],
      '–°–¥–µ–ª–∫–∞.–¢–µ–≥–∏': ['–¢–µ–≥–∏ —Å–¥–µ–ª–∫–∏','–¢–µ–≥–∏'],
      '–ö–µ–º —Å–æ–∑–¥–∞–Ω–∞': ['–ê–≤—Ç–æ—Ä','–°–æ–∑–¥–∞—Ç–µ–ª—å'],
      
      // CONTACT
      '–ö–æ–Ω—Ç–∞–∫—Ç.–§–ò–û': ['–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–∞–∫—Ç','–ö–æ–Ω—Ç–∞–∫—Ç.–ò–º—è','–ö–æ–Ω—Ç–∞–∫—Ç'],
      '–ö–æ–Ω—Ç–∞–∫—Ç.–¢–µ–ª–µ—Ñ–æ–Ω': ['–¢–µ–ª–µ—Ñ–æ–Ω','Phone','–†–∞–±–æ—á–∏–π —Ç–µ–ª–µ—Ñ–æ–Ω (–∫–æ–Ω—Ç–∞–∫—Ç)'],
      '–ö–æ–Ω—Ç–∞–∫—Ç.–ù–æ–º–µ—Ä –ª–∏–Ω–∏–∏ MANGO OFFICE': ['–ù–æ–º–µ—Ä –ª–∏–Ω–∏–∏ MANGO OFFICE (–∫–æ–Ω—Ç–∞–∫—Ç)'],
      '–°–¥–µ–ª–∫–∞.–ù–æ–º–µ—Ä –ª–∏–Ω–∏–∏ MANGO OFFICE': ['–ù–æ–º–µ—Ä –ª–∏–Ω–∏–∏ MANGO OFFICE'],
      
      // UTM
      '–°–¥–µ–ª–∫–∞.utm_source': ['utm_source','UTM_SOURCE','–ò—Å—Ç–æ—á–Ω–∏–∫'],
      '–°–¥–µ–ª–∫–∞.utm_medium': ['utm_medium','UTM_MEDIUM','–ö–∞–Ω–∞–ª'],
      '–°–¥–µ–ª–∫–∞.utm_campaign': ['utm_campaign','UTM_CAMPAIGN','–ö–∞–º–ø–∞–Ω–∏—è'],
      '–°–¥–µ–ª–∫–∞.utm_term': ['utm_term','UTM_TERM'],
      '–°–¥–µ–ª–∫–∞.utm_content': ['utm_content','UTM_CONTENT'],
      '–°–¥–µ–ª–∫–∞.utm_referrer': ['utm_referrer','referer','REFERRER','REFERER'],
      '–°–¥–µ–ª–∫–∞.–ò—Å—Ç–æ—á–Ω–∏–∫': ['–ò—Å—Ç–æ—á–Ω–∏–∫','Source'],
      '–°–¥–µ–ª–∫–∞.R.–ò—Å—Ç–æ—á–Ω–∏–∫ —Å–¥–µ–ª–∫–∏': ['R.–ò—Å—Ç–æ—á–Ω–∏–∫ —Å–¥–µ–ª–∫–∏'],
      '–°–¥–µ–ª–∫–∞.–¢–∏–ø –ª–∏–¥–∞': ['–¢–∏–ø –ª–∏–¥–∞'],
      
      // ANALYTICS
      '–°–¥–µ–ª–∫–∞.YM_CLIENT_ID': ['YM_CLIENT_ID'],
      '–°–¥–µ–ª–∫–∞._ym_uid': ['_ym_uid'],
      '–°–¥–µ–ª–∫–∞.GA_CLIENT_ID': ['GA_CLIENT_ID'],
      '–°–¥–µ–ª–∫–∞.FORMID': ['FORMID'],
      '–°–¥–µ–ª–∫–∞.FORMNAME': ['FORMNAME'],
      '–°–¥–µ–ª–∫–∞.BUTTON_TEXT': ['BUTTON_TEXT'],
      '–°–¥–µ–ª–∫–∞.DATE': ['DATE'],
      '–°–¥–µ–ª–∫–∞.TIME': ['TIME'],
      '–°–¥–µ–ª–∫–∞.REFERER': ['REFERER']
    }
  },

  // ===== –ê–ù–ê–õ–ò–ó –û–¢–ö–ê–ó–û–í =====
  refusals: {
    SOURCE_SHEET: '–†–ê–ë–û–ß–ò–ô –ê–ú–û',
    OUTPUT_SHEET: '–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–∞–∑–æ–≤',
    GPT_MODEL: 'gpt-4o',
    FALLBACK_MODEL: 'gpt-4o-mini',
    MAX_REASONS: 10,
    MIN_FREQUENCY: 2,
    SAMPLE_SIZE: 50
  },

  // ===== –°–†–ê–í–ù–ò–¢–ï–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ö–ê–ù–ê–õ–û–í =====
  channels: {
    SOURCE_SHEET: '–†–ê–ë–û–ß–ò–ô –ê–ú–û',
    OUTPUT_SHEET: '–°–†–ê–í–ù–ò–¢–ï–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó',
    CHART_START_DATE: '2025-04-01',
    GPT_MODEL: 'gpt-4o',
    COLORS: {
      SUCCESS: '#28a745',
      WARNING: '#ffc107', 
      DANGER: '#dc3545',
      INFO: '#17a2b8',
      LIGHT: '#f8f9fa'
    },
    CHANNEL_COLORS: {
      '–û—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç': '#4285f4',
      '–Ø–Ω–¥–µ–∫—Å': '#ff3333', 
      '2–ì–ò–°': '#00b956',
      'Telegram': '#0088cc',
      '–°–æ—Ü —Å–µ—Ç–∏': '#833ab4'
    }
  },

  // ===== –ê–ù–ê–õ–ò–ó –ü–ï–†–í–´–• –ö–ê–°–ê–ù–ò–ô =====
  firstTouch: {
    RA_SHEET: '–†–ê–ë–û–ß–ò–ô –ê–ú–û',
    OUTPUT_SHEET: 'FIRST-TOUCH ANALYSIS',
    DETAIL_LIMIT: 50,
    MIN_CLIENTS: 3,
    GPT_MODEL: 'gpt-4o',
    CHANNEL_MAPPING: {
      '–û—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç': ['—Å–∞–π—Ç', 'site', '–æ—Å–Ω–æ–≤–Ω–æ–π'],
      '–Ø–Ω–¥–µ–∫—Å': ['yandex', '—è–Ω–¥–µ–∫—Å', 'direct'],
      '2–ì–ò–°': ['2gis', '2–≥–∏—Å', 'gis'],
      '–¢–µ–ª–µ–≥—Ä–∞–º': ['telegram', '—Ç–≥', 't.me'],
      '–í–ö–æ–Ω—Ç–∞–∫—Ç–µ': ['vk', '–≤–∫', 'vkontakte']
    }
  },

  // ===== –ö–û–õ–õ-–¢–†–ï–ö–ò–ù–ì =====
  callTracking: {
    RA_SHEET: '–†–ê–ë–û–ß–ò–ô –ê–ú–û',
    DIRECTORY_SHEET: '–ö–æ–ª–ª–¢—Ä–µ–∫–∏–Ω–≥',
    REPORT_SHEET: '–ö–æ–ª–ª–¢—Ä–µ–∫–∏–Ω–≥',
    CHANNEL_COLORS: {
      '–û—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç': '#4285f4',
      '–Ø–Ω–¥–µ–∫—Å': '#ff3333',
      '2–ì–ò–°': '#00b956', 
      'Telegram': '#0088cc',
      'Default': '#6c757d'
    }
  },

  // ===== –°–í–û–î–ù–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê AMO =====
  amoDashboard: {
    RA_SHEET: '–†–ê–ë–û–ß–ò–ô –ê–ú–û',
    REPORT_SHEET: '–°–í–û–î–ù–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê AMOcrm',
    SUCCESS_STATUSES: ['–û–ø–ª–∞—á–µ–Ω–æ', '–£—Å–ø–µ—à–Ω–æ –≤ –†–ü', '–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ'],
    MONTHS_BACK: 12,
    TOP_N: 10
  },

  // ===== –õ–ò–î–´ –ü–û –ö–ê–ù–ê–õ–ê–ú (–î–ï–¢–ê–õ–¨–ù–û) =====
  channelDetails: {
    RA_SHEET: '–†–ê–ë–û–ß–ò–ô –ê–ú–û',
    CHANNELS: {
      site: '–û—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç + –ö–æ–Ω—Ç–µ–∫—Å—Ç',
      yandex: '–Ø–Ω–¥–µ–∫—Å', 
      gis2: '2–ì–ò–°',
      telegram: 'Telegram',
      vk: '–í–ö–æ–Ω—Ç–∞–∫—Ç–µ'
    }
  },

  // ===== –°–ö–í–û–ó–ù–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê =====
  e2e: {
    SHEETS: {
      DEALS: '–†–ê–ë–û–ß–ò–ô –ê–ú–û',
      SPEND: '–†–∞—Å—Ö–æ–¥—ã –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞',
      GUESTS: 'Guests RP', 
      DASH: '–°–ö–í–û–ó–ù–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê'
    },
    SUCCESS_RE: /(–æ–ø–ª–∞—á|—É—Å–ø–µ—à.*–≤.*—Ä–ø|—É—Å–ø–µ—à.*—Ä–µ–∞–ª–∏–∑)/i,
    COLS: {
      created: ['–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è','Created','DATE'],
      status: ['–°—Ç–∞—Ç—É—Å','Status'],
      budget: ['–ë—é–¥–∂–µ—Ç','Budget','–°—É–º–º–∞ ‚ÇΩ'],
      telTag: ['R.–ò—Å—Ç–æ—á–Ω–∏–∫ –¢–ï–õ —Å–¥–µ–ª–∫–∏'],
      utm: ['utm_source','UTM_SOURCE'],
      phone: ['–¢–µ–ª–µ—Ñ–æ–Ω','–ö–æ–Ω—Ç–∞–∫—Ç.–¢–µ–ª–µ—Ñ–æ–Ω','Phone']
    }
  },

  // ===== –ë–¨–Æ–¢–ò (–ê–ù–ê–õ–ò–ó –ö–ê–ù–ê–õ–û–í –ü–†–ò–í–õ–ï–ß–ï–ù–ò–Ø) =====
  beauty: {
    RA_SHEET: '–†–ê–ë–û–ß–ò–ô –ê–ú–û',
    DIRECTORY_SHEET: '–ö–æ–ª–ª–¢—Ä–µ–∫–∏–Ω–≥',
    BUDGETS_SHEET: '–ë–Æ–î–ñ–ï–¢–´',
    ACQ_SHEET: '–ê–ù–ê–õ–ò–ó –ö–ê–ù–ê–õ–û–í –ü–†–ò–í–õ–ï–ß–ï–ù–ò–Ø'
  },

  // ===== –ï–ñ–ï–î–ù–ï–í–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê =====
  dailyStats: {
    SOURCE: '–†–ê–ë–û–ß–ò–ô –ê–ú–û',
    OUTPUT: '–ï–ñ–ï–î–ù–ï–í–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê',
    SUCCESS: ['–û–ø–ª–∞—á–µ–Ω–æ', '–£—Å–ø–µ—à–Ω–æ –≤ –†–ü', '–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ'],
    DAYS_BACK: 30
  },

  // ===== –û–¢–î–ï–õ –ë–†–û–ù–ò–†–û–í–ê–ù–ò–Ø =====
  teamPerformance: {
    RA_SHEET: '–†–ê–ë–û–ß–ò–ô –ê–ú–û',
    REPORT_SHEET: '‚ö° –≠–§–§–ï–ö–¢–ò–í–ù–û–°–¢–¨ –ö–û–ú–ê–ù–î–´ –ò –ê–ù–ê–õ–ò–¢–ò–ö–ê',
    TOP_N: 10,
    PERFORMANCE_COLORS: {
      HIGH: '#28a745',
      MEDIUM: '#ffc107',
      LOW: '#dc3545'
    }
  },

  // ===== –ú–ê–†–ö–ï–¢–ò–ù–ì –ò –ö–ê–ù–ê–õ–´ =====
  marketing: {
    SOURCE: '–†–ê–ë–û–ß–ò–ô –ê–ú–û',
    BUDGETS: '–†–∞—Å—Ö–æ–¥—ã –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞',
    OUTPUT: '–ú–ê–†–ö–ï–¢–ò–ù–ì –ò –ö–ê–ù–ê–õ–´',
    ROI_THRESHOLD: 1.5
  },

  // ===== –ê–ù–ê–õ–ò–¢–ò–ö–ê –õ–ò–î–û–í –ü–û –ö–ê–ù–ê–õ–ê–ú =====
  leadsByChannel: {
    SOURCE: '–†–ê–ë–û–ß–ò–ô –ê–ú–û',
    OUTPUT: '–ê–ù–ê–õ–ò–¢–ò–ö–ê –õ–ò–î–û–í –ü–û –ö–ê–ù–ê–õ–ê–ú',
    CHANNEL_MAPPING: {
      '—Å–∞–π—Ç': '–û—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç',
      'yandex': '–Ø–Ω–¥–µ–∫—Å',
      '2gis': '2–ì–ò–°',
      'telegram': 'Telegram'
    }
  },

  // ===== –î–ò–ù–ê–ú–ò–ö–ê –ü–û –ú–ï–°–Ø–¶–ê–ú =====
  monthly: {
    SOURCE: '–†–ê–ë–û–ß–ò–ô –ê–ú–û',
    OUTPUT: '–î–ò–ù–ê–ú–ò–ö–ê –ü–û –ú–ï–°–Ø–¶–ê–ú',
    MONTHS_BACK: 24
  },

  // ===== –í–´–ì–†–£–ó–ö–ê –Ø–ù–î–ï–ö–°.–î–ò–†–ï–ö–¢ =====
  yandexDirect: {
    SOURCE: '–†–ê–ë–û–ß–ò–ô –ê–ú–û',
    OUTPUT_DIRECT: '–í–´–ì–†–£–ó–ö–ê –Ø–ù–î–ï–ö–° –î–ò–†–ï–ö–¢',
    OUTPUT_SKIPPED: '–ü–†–û–ü–£–°–ö–ò –î–ò–†–ï–ö–¢',
    PAID_STATUSES: ['–û–ü–õ–ê–ß–ï–ù–û', '–£—Å–ø–µ—à–Ω–æ –≤ –†–ü', '–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ'],
    HEADER_ALIASES: {
      ymClientId: ['ym_client_id', 'ym client id', 'ym clientid', 'ym id', 'ymid'],
      status: ['—Å—Ç–∞—Ç—É—Å'],
      budget: ['–±—é–¥–∂–µ—Ç', '—Å—É–º–º–∞', '—Å—É–º–º–∞ ‚ÇΩ', '—Å—É–º–º–∞ —Ä—É–±', '—Å—É–º–º–∞ —Ä'],
      closeDate: ['–¥–∞—Ç–∞ –∑–∞–∫—Ä—ã—Ç–∏—è', '–¥–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è'],
      reserveDate: ['–¥–∞—Ç–∞ –±—Ä–æ–Ω–∏', '–¥–∞—Ç–∞ —Ä–µ–∑–µ—Ä–≤–∞']
    }
  },

  // ===== TOP-40 –ö–õ–ò–ï–ù–¢–û–í =====
  top40: {
    SOURCE: 'Guests RP',
    OUTPUT: '–¢–û–ü-40 –ö–õ–ò–ï–ù–¢–û–í',
    TOP_N: 40,
    MIN_AMOUNT: 1000
  },

  // ===== –°–ö–í–û–ó–ù–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê –°–ê–ô–¢ =====
  siteAnalytics: {
    SHEETS: {
      SITE: '–ó–∞—è–≤–∫–∏ —Å –°–∞–π—Ç–∞',
      AMO: '–†–ê–ë–û–ß–ò–ô –ê–ú–û',
      SITE_DASH: '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –°–∞–π—Ç–∞',
      CROSS_DASH: '–°–∫–≤–æ–∑–Ω–∞—è –°–∞–π—Ç ‚Üí AMO'
    },
    ATTRIB_WINDOW_DAYS: 30,
    SUCCESS_RE: /(–æ–ø–ª–∞—á|—É—Å–ø–µ—à.*–≤.*—Ä–ø|—É—Å–ø–µ—à.*—Ä–µ–∞–ª–∏–∑)/i
  },

  // ===== UTM –ê–ù–ê–õ–ò–¢–ò–ö–ê =====
  utm: {
    SHEETS: {
      SITE: '–ó–∞—è–≤–∫–∏ —Å –°–∞–π—Ç–∞',
      RA: '–†–ê–ë–û–ß–ò–ô –ê–ú–û',
      DASH: 'UTM –ê–ù–ê–õ–ò–¢–ò–ö–ê'
    },
    ATTRIB_WINDOW_DAYS: 30,
    SUCCESS_RE: /(–æ–ø–ª–∞—á|—É—Å–ø–µ—à.*–≤.*—Ä–ø|—É—Å–ø–µ—à.*—Ä–µ–∞–ª–∏–∑)/i
  },

  // ===== GPT –ü–†–û–ú–ü–¢–´ =====
  prompts: {
    refusalAnalysis: `–¢—ã ‚Äî –≤–µ–¥—É—â–∏–π –∞–Ω–∞–ª–∏—Ç–∏–∫ –ø—Ä–æ–¥–∞–∂ —Å –æ–ø—ã—Ç–æ–º —Ä–∞–±–æ—Ç—ã 15+ –ª–µ—Ç.
    
–ó–ê–î–ê–ß–ê: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–∫–∞–∑–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –¥–∞–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.

–ö–û–ù–¢–ï–ö–°–¢: –¢—ã –ø–æ–ª—É—á–∏—à—å –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–∏—á–∏–Ω–∞—Ö –æ—Ç–∫–∞–∑–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ—Ç –ø–æ–∫—É–ø–∫–∏/–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–Ω–æ–º –±–∏–∑–Ω–µ—Å–µ.

–¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –ê–ù–ê–õ–ò–ó–£:
1. –í—ã–¥–µ–ª–∏ –¢–û–ü-5 –≥–ª–∞–≤–Ω—ã—Ö –ø—Ä–∏—á–∏–Ω –æ—Ç–∫–∞–∑–æ–≤
2. –î–ª—è –∫–∞–∂–¥–æ–π –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–µ–¥–ª–æ–∂–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
3. –û—Ü–µ–Ω–∏ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏—é
4. –î–∞–π –æ–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê:
- –ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
- –¢–æ–ø –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–∫–∞–∑–æ–≤ —Å –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

–ü–∏—à–∏ –¥–µ–ª–æ–≤—ã–º —è–∑—ã–∫–æ–º, –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –∏ –ø–æ –¥–µ–ª—É.`,

    channelAnalysis: `–¢—ã ‚Äî —Å—Ç–∞—Ä—à–∏–π –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥-–∞–Ω–∞–ª–∏—Ç–∏–∫ —Å –æ–ø—ã—Ç–æ–º performance-–º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞ 10+ –ª–µ—Ç.
    
–ó–ê–î–ê–ß–ê: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–∞–Ω–∞–ª–æ–≤ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –∏ –¥–∞–π —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.

–ö–û–ù–¢–ï–ö–°–¢: –†–µ—Å—Ç–æ—Ä–∞–Ω–Ω—ã–π –±–∏–∑–Ω–µ—Å, –º–Ω–æ–≥–æ–∫–∞–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ (—Å–∞–π—Ç, –Ø–Ω–¥–µ–∫—Å, 2–ì–ò–°, —Å–æ—Ü—Å–µ—Ç–∏).

–ê–ù–ê–õ–ò–ó–ò–†–£–ô:
1. –ö–æ–Ω–≤–µ—Ä—Å–∏—é –ø–æ –∫–∞–Ω–∞–ª–∞–º
2. –ö–∞—á–µ—Å—Ç–≤–æ –ª–∏–¥–æ–≤
3. –°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è
4. –†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∫–∞–Ω–∞–ª–æ–≤
5. –¢—Ä–µ–Ω–¥—ã –∏ –¥–∏–Ω–∞–º–∏–∫—É

–î–ê–®–ë–û–†–î –î–û–õ–ñ–ï–ù –°–û–î–ï–†–ñ–ê–¢–¨:
- –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã –∏ –∏–Ω—Å–∞–π—Ç—ã
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±—é–¥–∂–µ—Ç–∞–º
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–æ–Ω—ã –∏ —Å–ø–æ—Å–æ–±—ã –∏—Ö —Ä–µ—à–µ–Ω–∏—è

–ü–∏—à–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏, —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ ROI –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ.`,

    firstTouchAnalysis: `–¢—ã ‚Äî –¥–∏—Ä–µ–∫—Ç–æ—Ä –ø–æ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥—É —Å —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–æ–π –≤ –∞—Ç—Ä–∏–±—É—Ü–∏–æ–Ω–Ω–æ–º –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–∏.

–ó–ê–î–ê–ß–ê: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –º–æ–¥–µ–ª—å –ø–µ—Ä–≤—ã—Ö –∫–∞—Å–∞–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –±—Ä–µ–Ω–¥–æ–º.

–§–û–ö–£–°:
- –ö–∞–∫–∏–µ –∫–∞–Ω–∞–ª—ã –ª—É—á—à–µ –≤—Å–µ–≥–æ –ø—Ä–∏–≤–ª–µ–∫–∞—é—Ç –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ü—É—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –¥–æ –ø–æ–∫—É–ø–∫–∏
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–æ—á–µ–∫ –≤—Ö–æ–¥–∞
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤–æ—Ä–æ–Ω–∫–∏

–û–¢–í–ï–¢ –°–¢–†–£–ö–¢–£–†–ò–†–£–ô:
1. –ì–ª–∞–≤–Ω—ã–µ –∏–Ω—Å–∞–π—Ç—ã –æ –ø–µ—Ä–≤—ã—Ö –∫–∞—Å–∞–Ω–∏—è—Ö
2. –°–∞–º—ã–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –≤—Ö–æ–¥–∞
3. –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø–æ–≤–µ–¥–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤
4. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –∫–æ–Ω–≤–µ—Ä—Å–∏–∏

–ë—É–¥—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –≤ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è—Ö –∏ —Ü–∏—Ñ—Ä–∞—Ö.`
  }
};

// ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ö–û–ù–§–ò–ì–ê =====

/**
 * –ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–æ–¥—É–ª—è
 */
function getModuleConfig(moduleName) {
  const moduleConfig = CONFIG[moduleName];
  if (!moduleConfig) {
    throw new Error(`–ú–æ–¥—É–ª—å "${moduleName}" –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏`);
  }
  return moduleConfig;
}

/**
 * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ API –∫–ª—é—á–∞
 */
function validateApiKey() {
  if (!CONFIG.API_KEY) {
    throw new Error('API –∫–ª—é—á OpenAI –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ OPENAI_API_KEY –≤ –°–≤–æ–π—Å—Ç–≤–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞.');
  }
  return true;
}

/**
 * –ü–æ–ª—É—á–∏—Ç—å —Ü–≤–µ—Ç–∞ –¥–ª—è –∫–∞–Ω–∞–ª–∞
 */
function getChannelColor(channelName, module = 'channels') {
  const colors = CONFIG[module]?.CHANNEL_COLORS || CONFIG.channels.CHANNEL_COLORS;
  return colors[channelName] || colors['Default'] || '#6c757d';
}
